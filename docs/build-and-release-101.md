# Build
The `alfresco-extension-inspector` project uses _Travis CI_. \
The `.travis.yml` config file can be found in the root of the repository.


## Stages and Jobs
1. **Build**:  Java Build with Unit Tests, WhiteSource
3. **Release**: Publish to Nexus


## Branches
Travis CI builds differ by branch:
* `master` / `support/*` branches:
  - regular builds which include the _Build_ and _Tests_ stages;
  - if the commit message contains the `[trigger release]` tag, the builds will also 
  include the _Release_ stage;
  - PR builds where the latest commit contains the `[trigger release]` tag will execute dry runs 
  of the release jobs (no artifacts will be published until the PR is actually merged).
* `feature/*` / `fix/*` branches:
  - regular builds which include only the _Build_ and _Tests_ stages;

All other branches are ignored.


## Release process steps & info
Prerequisites:
 - the `master` / `support/*` branch is green and it contains all the changes that should be 
 included in the next release.

Steps:
1. Create a new branch with the (recommended, but not necessary) name `feature/ACS-###_release_version` from the
 `master` / `support/*` branch.
2. Update the project version if the current POM version is not the next desired release; use a
maven command, i.e.
    ```bash
    mvn versions:set -DnewVersion=#.##.#-SNAPSHOT versions:commit
    ```
3. Update the project's dependencies (remove the `-SNAPSHOT` suffixes - only for dependencies, not
 for the local project version).
4. Create a new commit with the `[trigger release]` tag in its message. If no local changes have 
been generated by steps (2) and (3), then an empty commit should be created - e.g.
     ```bash
     git commit --allow-empty -m "ACS-###: Release #.##.# [trigger release]"
     ```
 
     > The location of the `[trigger release]` tag in the commit message is irrelevant.

     > If for any reason your PR contains multiple commits, the commit with the `[trigger release]`
     tag should be the last (newest) one. This will trigger the Release dry runs.
     > When merging the PR, it's safest to use the "Squash and merge" option, and during the squash
     dialog you should ensure that the `[trigger release]` string is included in the commit message.
5. Open a new Pull Request from your `feature/ACS-###_release_version` branch into the original
`master` / `support/*` branch and wait for a green build; the **Release** stage on the PR build
 will only execute a _Dry_Run_ of the release.
6. Once it is approved, merge the PR, preferably through the **Rebase and merge** option. If the 
**Create a merge commit** (_Merge pull request_) or **Squash and merge** options are used, you 
need to ensure that the _commit message_ contains the `[trigger release]` tag (sub-string).


